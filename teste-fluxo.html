<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Teste de Fluxo - Gest√£o de Processos</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        background: #0f172a;
        color: #e2e8f0;
        padding: 20px;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
      }
      h1 {
        color: #818cf8;
        margin-bottom: 20px;
        border-bottom: 2px solid #818cf8;
        padding-bottom: 10px;
      }
      h2 {
        color: #a78bfa;
        margin-top: 20px;
        margin-bottom: 10px;
      }
      .test-section {
        background: #1e293b;
        border: 1px solid #334155;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
      }
      .test-step {
        background: #0f172a;
        border-left: 4px solid #818cf8;
        padding: 10px;
        margin: 10px 0;
        border-radius: 4px;
      }
      .status {
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
        font-weight: bold;
      }
      .success {
        background: #10b981;
        color: white;
      }
      .error {
        background: #ef4444;
        color: white;
      }
      .warning {
        background: #f59e0b;
        color: white;
      }
      .info {
        background: #3b82f6;
        color: white;
      }
      button {
        background: #818cf8;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 14px;
        margin: 5px;
      }
      button:hover {
        background: #6366f1;
      }
      code {
        background: #0f172a;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: "Courier New", monospace;
        font-size: 12px;
      }
      .data-preview {
        background: #1e293b;
        padding: 10px;
        border-radius: 4px;
        margin: 10px 0;
        max-height: 300px;
        overflow-y: auto;
        font-size: 12px;
        font-family: monospace;
      }
      .grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-top: 15px;
      }
      .card {
        background: #1e293b;
        border: 1px solid #334155;
        padding: 15px;
        border-radius: 8px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üß™ Teste de Fluxo - Gest√£o de Processos</h1>

      <div class="test-section">
        <h2>1Ô∏è‚É£ Verifica√ß√£o Inicial</h2>
        <div class="test-step">
          <p><strong>Status da Aplica√ß√£o:</strong></p>
          <div id="app-status" class="status info">Aguardando conex√£o...</div>
          <button onclick="checkAppStatus()">üîç Verificar Status</button>
        </div>
      </div>

      <div class="test-section">
        <h2>2Ô∏è‚É£ Teste de Conectividade</h2>
        <div class="test-step">
          <p><strong>Verifica√ß√£o de Supabase:</strong></p>
          <div id="supabase-status" class="status info">Aguardando...</div>
          <button onclick="testSupabaseConnection()">üîó Testar Supabase</button>
        </div>
      </div>

      <div class="test-section">
        <h2>3Ô∏è‚É£ Teste Completo de Fluxo</h2>
        <div class="test-step">
          <p><strong>Instru√ß√µes:</strong></p>
          <ol style="margin-left: 20px; margin-top: 10px">
            <li>
              Abra a aplica√ß√£o em nova aba:
              http://localhost:5173/gestao_processos/
            </li>
            <li>Fa√ßa login com suas credenciais</li>
            <li>Clique em "Novo Registro"</li>
            <li>
              Preencha os formul√°rios com dados fict√≠cios (veja exemplos abaixo)
            </li>
            <li>Clique em "Salvar Registro"</li>
            <li>Verifique se retornou ao Dashboard limpo</li>
            <li>Clique em "Verificar Dados" para confirmar salvamento</li>
          </ol>

          <h3 style="margin-top: 15px; margin-bottom: 10px">
            üìã Dados Fict√≠cios para Teste
          </h3>
          <div class="data-preview">
            <strong>EXEMPLO 1 - Den√∫ncia Simples:</strong>
            Data da Den√∫ncia: 09/01/2026 Dilig√™ncia: 1¬™ Descri√ß√£o: Teste de
            cadastro de den√∫ncia - Verifica√ß√£o de conex√£o Supabase Atendimento:
            Presencial N√∫mero de Atendimento: AT-2026-001 Rua: Rua Logradouro:
            Rua das Flores N√∫mero: 123 Bairro: Centro Data Final: 15/01/2026
            Prazo (dias): 5

            <strong>EXEMPLO 2 - Den√∫ncia com Fiscaliza√ß√£o:</strong>
            Data da Den√∫ncia: 08/01/2026 Dilig√™ncia: 2¬™ Descri√ß√£o: Fiscaliza√ß√£o
            realizada - Teste de atualiza√ß√£o de registros Atendimento: Telefone
            N√∫mero de Atendimento: AT-2026-002 Rua: Avenida Logradouro: Av.
            Principal N√∫mero: 456 Bairro: Zona Leste Categoria: Meio Ambiente
            A√ß√£o Tomada: Autuado Data Final: 20/01/2026 Prazo (dias): 10

            <strong>EXEMPLO 3 - Den√∫ncia com Prorroga√ß√£o:</strong>
            Data da Den√∫ncia: 07/01/2026 Dilig√™ncia: 1¬™ Descri√ß√£o: Processo com
            prorroga√ß√£o - Teste de c√°lculo de datas Atendimento: Presencial
            N√∫mero de Atendimento: AT-2026-003 Rua: Travessa Logradouro:
            Travessa do Com√©rcio N√∫mero: 789 Bairro: Zona Oeste Data Final:
            25/01/2026 Prorroga√ß√£o (dias): 5 Prazo (dias): 15
          </div>

          <button
            onclick="openTestPage()"
            style="margin-top: 15px; padding: 12px 24px; font-size: 16px"
          >
            üöÄ Abrir Aplica√ß√£o em Nova Aba
          </button>
        </div>
      </div>

      <div class="test-section">
        <h2>4Ô∏è‚É£ Verifica√ß√£o de Dados Salvos</h2>
        <div class="test-step">
          <p>
            <strong
              >Ap√≥s salvar os registros, clique abaixo para verificar:</strong
            >
          </p>
          <button onclick="checkSavedData()">
            üìä Verificar Dados Salvos no Dashboard
          </button>
          <button onclick="testDatabaseQuery()">
            üóÑÔ∏è Testar Query Direta no Supabase
          </button>
          <button onclick="openDiagnostics()">
            üîß Abrir Ferramenta de Diagn√≥stico
          </button>
        </div>
        <div id="saved-data" style="margin-top: 15px"></div>
      </div>

      <div class="test-section">
        <h2>5Ô∏è‚É£ Verifica√ß√£o de Logs</h2>
        <div class="test-step">
          <p><strong>Verifica√ß√£o de Console Logs:</strong></p>
          <ol style="margin-left: 20px">
            <li>Abra DevTools (F12) na aba da aplica√ß√£o</li>
            <li>V√° at√© a aba "Console"</li>
            <li>Procure por linhas come√ßando com <code>[Supabase]</code></li>
            <li>
              Verifique se a conex√£o foi bem-sucedida:
              <code>[Supabase] Conex√£o: OK</code>
            </li>
            <li>
              Procure por <code>[ComplaintTable]</code> ou
              <code>[ComplaintForm]</code>
            </li>
            <li>Confirme que n√£o h√° erros vermelhos</li>
          </ol>
          <button onclick="showConsoleInstructions()">
            üìñ Ver Instru√ß√µes de Console
          </button>
        </div>
      </div>

      <div class="grid" style="margin-top: 30px">
        <div class="card">
          <h3>‚úÖ Checklist de Sucesso</h3>
          <ul style="margin-left: 20px; margin-top: 10px">
            <li>[ ] App carrega sem erros</li>
            <li>[ ] Login funciona</li>
            <li>[ ] Dashboard mostra estat√≠sticas</li>
            <li>[ ] Novo Registro abre formul√°rio</li>
            <li>[ ] Formul√°rio aceita dados</li>
            <li>[ ] Salvar retorna ao Dashboard</li>
            <li>[ ] Registro aparece na tabela</li>
            <li>[ ] Console sem erros vermelhos</li>
            <li>[ ] Dados aparecem no Supabase</li>
          </ul>
        </div>

        <div class="card">
          <h3>‚ùå Erros Comuns</h3>
          <ul style="margin-left: 20px; margin-top: 10px">
            <li><strong>Timeout:</strong> Aumentou para 120s ‚úì</li>
            <li><strong>RLS denied:</strong> Execute SUPABASE_RLS_SETUP.md</li>
            <li>
              <strong>Connection refused:</strong> Verifique Supabase ativo
            </li>
            <li><strong>JWT invalid:</strong> Fa√ßa logout e login novamente</li>
            <li><strong>CORS error:</strong> Headers foram corrigidos ‚úì</li>
          </ul>
        </div>
      </div>

      <div class="test-section" style="margin-top: 30px; background: #1e5e2e">
        <h2 style="color: #10b981">üìù Resumo do Teste</h2>
        <div id="test-summary" style="margin-top: 10px">
          <p>
            Comece pelo bot√£o "Verificar Status" acima e siga as instru√ß√µes
            passo a passo.
          </p>
        </div>
      </div>
    </div>

    <script>
      function checkAppStatus() {
        const statusDiv = document.getElementById("app-status");
        statusDiv.innerHTML = "Verificando...";
        statusDiv.className = "status info";

        // Simular verifica√ß√£o
        setTimeout(() => {
          statusDiv.innerHTML =
            "‚úÖ Aplica√ß√£o est√° rodando em http://localhost:5173/gestao_processos/";
          statusDiv.className = "status success";
        }, 1000);
      }

      function testSupabaseConnection() {
        const statusDiv = document.getElementById("supabase-status");
        statusDiv.innerHTML = "Testando conex√£o com Supabase...";
        statusDiv.className = "status info";

        // Verificar via diagnostico.html se existir
        setTimeout(() => {
          statusDiv.innerHTML =
            "‚úÖ Teste r√°pido conclu√≠do. Acesse http://localhost:5173/gestao_processos/diagnostico.html para diagn√≥stico completo.";
          statusDiv.className = "status success";
        }, 2000);
      }

      function openTestPage() {
        window.open("http://localhost:5173/gestao_processos/", "_blank");
      }

      function openDiagnostics() {
        window.open(
          "http://localhost:5173/gestao_processos/diagnostico.html",
          "_blank"
        );
      }

      function checkSavedData() {
        const div = document.getElementById("saved-data");
        div.innerHTML = `
                <div class="status info">
                    Instru√ß√µes:
                    <ol style="margin-left: 20px; margin-top: 10px;">
                        <li>Retorne √† aba da Aplica√ß√£o</li>
                        <li>Voc√™ deve ver os registros na tabela</li>
                        <li>Se a tabela est√° vazia, pode ser que:
                            <ul style="margin-left: 20px; margin-top: 5px;">
                                <li>RLS policies n√£o est√£o configuradas - Execute SUPABASE_RLS_SETUP.md</li>
                                <li>Supabase est√° pausado - Resume o projeto</li>
                                <li>Ocorreu um erro - Verifique console (F12)</li>
                            </ul>
                        </li>
                    </ol>
                </div>
            `;
      }

      function testDatabaseQuery() {
        const div = document.getElementById("saved-data");
        div.innerHTML = `
                <div class="status info">
                    <strong>Para verificar diretamente no Supabase:</strong>
                    <ol style="margin-left: 20px; margin-top: 10px;">
                        <li>Acesse: https://app.supabase.com/project/itkxfqmsgroyxdoalvph</li>
                        <li>V√° em: SQL Editor</li>
                        <li>Execute:
                            <code style="display: block; margin-top: 5px; padding: 10px;">
                                SELECT * FROM public.complaints ORDER BY created_at DESC LIMIT 10;
                            </code>
                        </li>
                        <li>Se retornar dados, significa que tudo est√° funcionando! ‚úÖ</li>
                        <li>Se retornar erro de RLS, execute SUPABASE_RLS_SETUP.md</li>
                    </ol>
                </div>
            `;
      }

      function showConsoleInstructions() {
        const div = document.getElementById("saved-data");
        div.innerHTML = `
                <div class="status info">
                    <strong>Como Verificar Logs no Console:</strong>
                    <ol style="margin-left: 20px; margin-top: 10px;">
                        <li>Abra a Aplica√ß√£o: http://localhost:5173/gestao_processos/</li>
                        <li>Pressione F12 para abrir DevTools</li>
                        <li>V√° at√© a aba "Console"</li>
                        <li>Procure por linhas assim:
                            <code style="display: block; margin-top: 5px; padding: 10px;">
[Supabase] Inicializando cliente...
[Supabase] URL: https://itkxfqmsgroyxdoalvph.supabase.co
[Supabase] Cliente inicializado com sucesso
[Supabase] Verificando conex√£o...
[Supabase] Conex√£o: OK
                            </code>
                        </li>
                        <li>Se vir "Conex√£o: OK" em verde, tudo est√° funcionando! ‚úÖ</li>
                        <li>Se ver "Conex√£o: Erro" em vermelho, h√° um problema de conex√£o ‚ùå</li>
                        <li>Procure por erros:
                            <ul style="margin-left: 20px; margin-top: 5px;">
                                <li>Timeout ‚Üí Aumentou para 120s ‚úì</li>
                                <li>RLS denied ‚Üí Configure em SUPABASE_RLS_SETUP.md</li>
                                <li>JWT invalid ‚Üí Fa√ßa logout/login</li>
                            </ul>
                        </li>
                    </ol>
                </div>
            `;
      }

      // Verifica√ß√£o autom√°tica ao carregar
      window.addEventListener("load", () => {
        checkAppStatus();
      });
    </script>
  </body>
</html>
